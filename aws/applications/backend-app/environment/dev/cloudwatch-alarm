module "ec2_metric_alarms" {
  source  = "terraform-aws-modules/cloudwatch/aws//modules/metric-alarms-by-multiple-dimensions"
  version = "~> 3.0"

  alarm_name          = "instance-cpu-alarm"
  alarm_description   = "ec2 cpuutilization"
  comparison_operator = "GreaterThanOrEqualToThreshold"
  evaluation_periods  = 60
  threshold           = 30
  period              = 30
  unit                = "Count"
  datapoints_to_alarm = 1
 

  namespace   = "AWS/EC2"
  metric_name = "CPUUtilization"
  statistic   = "Average"

  dimensions = {
    "Instance1" = {
      InstanceId  = "i-0702dc8db1a4a7b90"
    }
  }

  alarm_actions = [module.cw_sns_topic.topic_arn]
}


#cloudifyops-dev-aurora01-one

module "rds_metric_alarms" {
  source  = "terraform-aws-modules/cloudwatch/aws//modules/metric-alarms-by-multiple-dimensions"
  version = "~> 3.0"

  alarm_name          = "rds-cpu-alarm"
  alarm_description   = "rds cpuutilization"
  comparison_operator = "GreaterThanOrEqualToThreshold"
  evaluation_periods  = 60
  threshold           = 90
  period              = 30
  unit                = "Count"
  datapoints_to_alarm = 1
 

  namespace   = "AWS/RDS"
  metric_name = "CPUUtilization"
  statistic   = "Average"

  dimensions = {
    "DBInstanceIdentifier" = {
      DBInstanceIdentifier  = "cloudifyops-dev-aurora01-one"
    }
  }

  alarm_actions = [module.cw_sns_topic.topic_arn]
}
